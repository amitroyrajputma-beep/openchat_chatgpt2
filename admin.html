<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel</title>
</head>
<body>

<h2>Admin â€“ Approve Users</h2>
<div id="list"></div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="firebase.js"></script>

<script>
const box = document.getElementById("list");

firebase.database().ref("requests").on("value", snap=>{
  box.innerHTML = "";

  snap.forEach(c=>{
    const d = c.val();
    if(d.status !== "pending") return;

    const div = document.createElement("div");
    div.innerHTML = `
      <b>${d.name}</b><br>
      <input id="room-${c.key}" placeholder="Room name">
      <button>Approve</button>
      <button>Reject</button>
      <hr>
    `;

    // APPROVE
    div.children[2].onclick = () => {
      const room = document.getElementById("room-"+c.key).value.trim();
      if(!room) return alert("Enter room name");

      firebase.database().ref("requests/"+c.key).set({
        name: d.name,
        status: "approved",
        room: room,
        time: d.time
      });
    };

    // REJECT
    div.children[3].onclick = () => {
      firebase.database().ref("requests/"+c.key).set({
        name: d.name,
        status: "rejected",
        room: "",
        time: d.time
      });
    };

    box.appendChild(div);
  });
});
</script>

</body>
</html>
